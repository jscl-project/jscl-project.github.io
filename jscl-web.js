if (typeof importScripts !== 'undefined') importScripts('./jscl.js');
(function(jscl){
'use strict';
(function(internals){ var values = internals.values;var l1=internals.make_lisp_string('JSCL/WEB-REPL');
var l2=internals.intern('NIL','COMMON-LISP');
var l3=internals.intern('%DEFPACKAGE');
var l4=internals.intern('PACKAGE-USE-LIST','COMMON-LISP');
var l5=internals.intern('UNUSE-PACKAGE','COMMON-LISP');
var l6=internals.intern('SHADOW','COMMON-LISP');
var l7=internals.intern('FIND-SYMBOL-FOR-IMPORT');
var l8=internals.intern('MAPCAR','COMMON-LISP');
var l9=internals.intern('MAPCAN','COMMON-LISP');
var l10=internals.intern('SHADOWING-IMPORT','COMMON-LISP');
var l12=internals.intern('CL','KEYWORD');
l12.value=l12;
var l13=internals.intern('JSCL/FFI','KEYWORD');
l13.value=l13;
var l11=internals.QIList(l12,l13,l2);
var l14=internals.intern('USE-PACKAGE','COMMON-LISP');
var l15=internals.intern('IMPORT','COMMON-LISP');
var l16=internals.intern('INTERN','COMMON-LISP');
var l17=internals.intern('STRING','COMMON-LISP');
var l18=internals.intern('EXPORT','COMMON-LISP');
(function(v1){l5.fvalue(l4.fvalue(v1),v1);
l6.fvalue(l2,v1);
l10.fvalue(l9.fvalue((function JSCL_USER_NIL(v2){internals.checkArgs(arguments.length,1);
var v3=this;
return internals.mvcall(l8.fvalue,(function JSCL_USER_NIL(v4){internals.checkArgs(arguments.length,1);
var v5=this;
return internals.mvcall(l7.fvalue,v4,v2.$$jscl_car);
}),v2.$$jscl_cdr);
}),l2),v1);
l14.fvalue(l11,v1);
l15.fvalue(l9.fvalue((function JSCL_USER_NIL(v6){internals.checkArgs(arguments.length,1);
var v7=this;
return internals.mvcall(l8.fvalue,(function JSCL_USER_NIL(v8){internals.checkArgs(arguments.length,1);
var v9=this;
return internals.mvcall(l7.fvalue,v8,v6.$$jscl_car);
}),v6.$$jscl_cdr);
}),l2),v1);
(function(){return (function(v11,v12){(function(){while (v11!==l2.value){v12=v11.$$jscl_car;
l16.fvalue(v12,v1);
l2.value;
v11=v11.$$jscl_cdr;
}return l2.value;
})();
return l2.value;
})(l2,l2.value);
})();
l18.fvalue(l8.fvalue((function JSCL_USER_NIL(v13){internals.checkArgs(arguments.length,1);
var v14=this;
return internals.mvcall(l16.fvalue,l17.fvalue(v13),v1);
}),l2),v1);
l2.value;
return v1;
})(l3.fvalue(l1,l2));
var l19=internals.intern('*PACKAGE*','COMMON-LISP');
var l20=internals.intern('JSCL/WEB-REPL','KEYWORD');
l20.value=l20;
var l21=internals.intern('FIND-PACKAGE-OR-FAIL');
l19.value=l21.fvalue(l20);
var l22=internals.intern('%WRITE-STRING','JSCL/WEB-REPL');
var l23=internals.intern('T','COMMON-LISP');
var l24=internals.make_lisp_string('jqconsole-output');
var l25=internals.intern('*ROOT*');
l22.fvalue=(function(){var FUNC=(function JSCL_USER_WRITESTRING(v15,v16,v17){internals.checkArgsAtLeast(arguments.length,1);
internals.checkArgsAtMost(arguments.length,3);
switch(arguments.length){case 1:v16=l23.value;
;
case 2:v17=l24;
;
default:break;
}var v18=this;
return (function(){return (function(v20,v21){return internals.symbolValue(l25)['jqconsole']!==l2.value?v16!==l2.value?internals.symbolValue(l25)['jqconsole']['Write'](v20,v21):internals.symbolValue(l25)['jqconsole']['Write'](v20,v21,''):internals.symbolValue(l25)['console']['log'](v20);
})(internals.xstring(v15),internals.xstring(v17));
})();
});
FUNC.fname=internals.make_lisp_string('%WRITE-STRING');
return FUNC;
})();
l22;
var l26=internals.intern('LOAD-HISTORY','JSCL/WEB-REPL');
l26.fvalue=(function(){var FUNC=(function JSCL_USER_LOADHISTORY(){internals.checkArgsAtMost(arguments.length,0);
var v22=this;
return (function(){return (function(v24){return (v24===null?l23.value:l2.value)!==l2.value?internals.values1(l2.value):internals.symbolValue(l25)['jqconsole']['SetHistory'](internals.symbolValue(l25)['JSON']['parse'](v24));
})(internals.symbolValue(l25)['localStorage']['getItem']('jqhist'));
})();
});
FUNC.fname=internals.make_lisp_string('LOAD-HISTORY');
return FUNC;
})();
l26;
var l27=internals.intern('SAVE-HISTORY','JSCL/WEB-REPL');
l27.fvalue=(function(){var FUNC=(function JSCL_USER_SAVEHISTORY(){internals.checkArgsAtMost(arguments.length,0);
var v25=this;
return (function(){return internals.symbolValue(l25)['localStorage']['setItem']('jqhist',internals.symbolValue(l25)['JSON']['stringify'](internals.symbolValue(l25)['jqconsole']['GetHistory']()));
})();
});
FUNC.fname=internals.make_lisp_string('SAVE-HISTORY');
return FUNC;
})();
l27;
var l28=internals.intern('+ERR-CSS+','JSCL/WEB-REPL');
var l29=internals.make_lisp_string('jqconsole-error');
l28.value=l29;
l28;
var l30=internals.intern('TOPLEVEL','JSCL/WEB-REPL');
var l31=internals.intern('GET-REPL-PROMPT');
var l32=internals.intern('CLSTRING');
var l33=internals.intern('*ERROR-OUTPUT*','COMMON-LISP');
var l34=internals.intern('FORMAT-ERROR');
var l35=internals.intern('COMPLAINT','KEYWORD');
l35.value=l35;
var l36=internals.make_lisp_string('Required argument missing');
var l37=internals.intern('CONTROL-STRING','KEYWORD');
l37.value=l37;
var l38=internals.make_lisp_string('ERROR[!]: ~a~%~A~%');
var l39=internals.intern('OFFSET','KEYWORD');
l39.value=l39;
var l40=internals.intern('ERROR','COMMON-LISP');
var l41=internals.make_lisp_string('ERROR[!]: ');
var l42=internals.intern('WRITE-STRING','COMMON-LISP');
var l43=internals.intern('PRINC','COMMON-LISP');
var l44=internals.intern('TERPRI','COMMON-LISP');
var l45=internals.make_lisp_string('');
var l46=internals.intern('CALL-FORMATTER');
var l47=internals.intern('*HANDLER-BINDINGS*');
var l48=internals.intern('SERIOUS-CONDITION','COMMON-LISP');
var l49=internals.make_lisp_string('~A: ~A~%');
var l50=internals.make_lisp_string(': ');
var l51=internals.intern('CLASS-OF','COMMON-LISP');
var l52=internals.intern('CLASS-NAME','COMMON-LISP');
var l53=internals.intern('*TRACE-OUTPUT*','COMMON-LISP');
var l54=internals.intern('FROM','KEYWORD');
l54.value=l54;
var l55=internals.intern('SIGNAL','COMMON-LISP');
var l56=internals.intern('FORMAT-BACKTRACE');
var l57=internals.intern('%%ERROR');
var l58=internals.intern('LIST','COMMON-LISP');
var l59=internals.intern('EVAL-INTERACTIVE-INPUT');
var l60=internals.intern('FRESH-LINE','COMMON-LISP');
var l61=internals.intern('PRIN1','COMMON-LISP');
var l62=internals.intern('%SEXPR-INCOMPLETE');
l30.fvalue=(function(){var FUNC=(function JSCL_USER_TOPLEVEL(){internals.checkArgsAtMost(arguments.length,0);
var v27=this;
return (function(){internals.symbolValue(l25)['jqconsole']['RegisterMatching']('(',')','parents');
(function(v29){return internals.symbolValue(l25)['jqconsole']['Write'](v29,'jqconsole-prompt');
})(internals.xstring(l31.fvalue()));
return (function(v60){return internals.symbolValue(l25)['jqconsole']['Prompt'](true,v60,(function JSCL_USER_NIL(v66){internals.checkArgsAtLeast(arguments.length,1);
var v65=l2.value;
var I;
for (I=arguments.length-1;I>=1;I--)v65=new internals.Cons(arguments[I],v65);
var v67=this;
return (function(v68){return v68!==l2.value?internals.values1(v68):internals.values1(false);
})(l62.fvalue(l32.fvalue(v66)));
}));
})((function JSCL_USER_NIL(v30){internals.checkArgs(arguments.length,1);
var v31=this;
return (function(){(function(){try{return (function(){try{var v42=[];
return (function(v43){return internals.bindSpecialBindings([l47],[v43],(function(){(function(){var v45=new internals.Cons(l48,(function JSCL_USER_NIL(v46){internals.checkArgs(arguments.length,1);
var v47=this;
l46.fvalue(internals.symbolValue(l33),(function JSCL_USER_NIL(v49,v50,v51){internals.checkArgsAtLeast(arguments.length,1);
switch(arguments.length){case 1:v50=l40.fvalue(l34,l35.value,l36,l37.value,l49,l39.value,1);
;
case 2:v51=l40.fvalue(l34,l35.value,l36,l37.value,l49,l39.value,5);
;
default:break;
}var v48=l2.value;
var I;
for (I=arguments.length-1;I>=3;I--)v48=new internals.Cons(arguments[I],v48);
var v52=this;
(function(){l43.fvalue(v50,v49);
l42.fvalue(l50,v49);
l43.fvalue(v51,v49);
return l44.fvalue(v49);
})();
return internals.values1(v48);
}),l52.fvalue(l51.fvalue(v46)),v46);
l56.fvalue(internals.symbolValue(l53),l54.value,internals.symbolFunction(l55));
return (function(){throw new internals.BlockNLX(v42,l2.value,null,'BAIL-OUT');
})();
}));
var v54=new internals.Cons(v45,internals.symbolValue(l47));
return l47.value=v54;
})();
return (function(){try{return (function(){return (function(v58,v59){(function(){while (v58!==l2.value){v59=v58.$$jscl_car;
l60.fvalue();
l61.fvalue(v59);
l44.fvalue();
l2.value;
v58=v58.$$jscl_cdr;
}return l2.value;
})();
return l2.value;
})((function(){var FUNC=internals.symbolFunction(l58);
var ARGS=[];
var _R;
_R=internals.withMV((function(){return internals.mvcall(l59.fvalue,l32.fvalue(v30));
}));
if (_R.mv!==null) ARGS=ARGS.concat(_R.mv);
 else ARGS.push(_R.result);
return internals.mvcall(FUNC,...ARGS);
})(),l2.value);
})();
}catch (v55){return (internals.isNLX(v55)?l23.value:l2.value)!==l2.value?(function(){throw v55;
})():l57.fvalue((function(v56){return (v56===undefined?l23.value:l2.value)!==l2.value?l32.fvalue(v55):l32.fvalue(v56);
})(v55['message']));
}})();
}));
})(internals.symbolValue(l47));
}catch (CF){if (CF instanceof internals.BlockNLX&&CF.id==v42) return CF.value;
 else throw CF;
}})();
}catch (v33){return (function(v35){return l46.fvalue(internals.symbolValue(l33),(function JSCL_USER_NIL(v37,v38,v39){internals.checkArgsAtLeast(arguments.length,1);
switch(arguments.length){case 1:v38=l40.fvalue(l34,l35.value,l36,l37.value,l38,l39.value,11);
;
case 2:v39=l40.fvalue(l34,l35.value,l36,l37.value,l38,l39.value,15);
;
default:break;
}var v36=l2.value;
var I;
for (I=arguments.length-1;I>=3;I--)v36=new internals.Cons(arguments[I],v36);
var v40=this;
(function(){l42.fvalue(l41,v37);
l43.fvalue(v38,v37);
l44.fvalue(v37);
l43.fvalue(v39,v37);
return l44.fvalue(v37);
})();
return internals.values1(v36);
}),v35,l32.fvalue(v33['stack']??l45));
})((function(v34){return (v34===undefined?l23.value:l2.value)!==l2.value?l32.fvalue(v33):l32.fvalue(v34);
})(v33['message']));
}})();
l27.fvalue();
return internals.mvcall(l30.fvalue);
})();
}));
})();
});
FUNC.fname=internals.make_lisp_string('TOPLEVEL');
return FUNC;
})();
l30;
var l63=internals.intern('WRITE-WELCOME-MESSAGE','JSCL/WEB-REPL');
var l64=internals.intern('WELCOME-MESSAGE-ITEMS');
var l65=internals.intern('FIRST','COMMON-LISP');
var l66=internals.intern('STR','KEYWORD');
l66.value=l66;
var l67=internals.intern('EQL','COMMON-LISP');
var l68=internals.intern('SECOND','COMMON-LISP');
var l69=internals.intern('BOLD','KEYWORD');
l69.value=l69;
var l70=internals.make_lisp_string('<strong>~a</strong>');
var l71=internals.make_lisp_string('<strong>');
var l72=internals.make_lisp_string('</strong>');
var l73=internals.intern('LINK','KEYWORD');
l73.value=l73;
var l74=internals.make_lisp_string('<a href="~a" target="_blank">~a</a>');
var l75=internals.make_lisp_string('<a href="');
var l76=internals.make_lisp_string('" target="_blank">');
var l77=internals.make_lisp_string('</a>');
var l78=internals.intern('THIRD','COMMON-LISP');
var l79=internals.intern('NEWLINE','KEYWORD');
l79.value=l79;
var l80=internals.make_lisp_string("ECASE expression failed for the object `~S'.");
l63.fvalue=(function(){var FUNC=(function JSCL_USER_WRITEWELCOMEMESSAGE(){internals.checkArgsAtMost(arguments.length,0);
var v69=this;
return (function(){return (function(){return (function(v72,v73){(function(){while (v72!==l2.value){v73=v72.$$jscl_car;
(function(v74){return (function(v75){return l67.fvalue(v75,l66)!==l2.value?(l2.value,l22.fvalue(l68.fvalue(v73))):l67.fvalue(v75,l69)!==l2.value?(l2.value,l22.fvalue(l46.fvalue(l2.value,(function JSCL_USER_NIL(v77,v78){internals.checkArgsAtLeast(arguments.length,1);
switch(arguments.length){case 1:v78=l40.fvalue(l34,l35.value,l36,l37.value,l70,l39.value,9);
;
default:break;
}var v76=l2.value;
var I;
for (I=arguments.length-1;I>=2;I--)v76=new internals.Cons(arguments[I],v76);
var v79=this;
(function(){l42.fvalue(l71,v77);
l43.fvalue(v78,v77);
return l42.fvalue(l72,v77);
})();
return internals.values1(v76);
}),l68.fvalue(v73)),l2.value)):l67.fvalue(v75,l73)!==l2.value?(l2.value,l22.fvalue(l46.fvalue(l2.value,(function JSCL_USER_NIL(v82,v83,v84){internals.checkArgsAtLeast(arguments.length,1);
switch(arguments.length){case 1:v83=l40.fvalue(l34,l35.value,l36,l37.value,l74,l39.value,10);
;
case 2:v84=l40.fvalue(l34,l35.value,l36,l37.value,l74,l39.value,30);
;
default:break;
}var v81=l2.value;
var I;
for (I=arguments.length-1;I>=3;I--)v81=new internals.Cons(arguments[I],v81);
var v85=this;
(function(){l42.fvalue(l75,v82);
l43.fvalue(v83,v82);
l42.fvalue(l76,v82);
l43.fvalue(v84,v82);
return l42.fvalue(l77,v82);
})();
return internals.values1(v81);
}),l78.fvalue(v73),l68.fvalue(v73)),l2.value)):l67.fvalue(v75,l79)!==l2.value?(l2.value,l22.fvalue(l17.fvalue('\n'))):(l2.value,l40.fvalue(l80,v74));
})(v74);
})(l65.fvalue(v73));
l2.value;
v72=v72.$$jscl_cdr;
}return l2.value;
})();
return internals.values1(l2.value);
})(l64.fvalue(),l2.value);
})();
})();
});
FUNC.fname=internals.make_lisp_string('WRITE-WELCOME-MESSAGE');
FUNC.docstring=internals.make_lisp_string('Render the welcome message as HTML via jqconsole.');
return FUNC;
})();
l63;
var l81=internals.intern('WEB-INIT','JSCL/WEB-REPL');
var l82=internals.intern('*STANDARD-OUTPUT*','COMMON-LISP');
var l83=internals.intern('WRITE-FN','KEYWORD');
l83.value=l83;
var l84=internals.intern('KIND','KEYWORD');
l84.value=l84;
var l85=internals.intern('WEB-REPL-OUTPUT-STREAM','JSCL/WEB-REPL');
var l86=internals.intern('MAKE-STREAM');
var l87=internals.intern('WEB-REPL-ERROR-STREAM','JSCL/WEB-REPL');
var l88=internals.make_lisp_string('CL-USER');
var l89=internals.intern('FIND-PACKAGE','COMMON-LISP');
l81.fvalue=(function(){var FUNC=(function JSCL_USER_WEBINIT(){internals.checkArgsAtMost(arguments.length,0);
var v87=this;
return (function(){l26.fvalue();
l82.value=l86.fvalue(l83.value,(function JSCL_USER_NIL(v89){internals.checkArgs(arguments.length,1);
var v90=this;
return internals.mvcall(l22.fvalue,v89);
}),l84.value,l85);
l33.value=l86.fvalue(l83.value,(function JSCL_USER_NIL(v91){internals.checkArgs(arguments.length,1);
var v92=this;
return internals.mvcall(l22.fvalue,v91,l23.value,internals.symbolValue(l28));
}),l84.value,l87);
l53.value=internals.symbolValue(l82);
l19.value=l89.fvalue(l88);
l63.fvalue();
return internals.symbolValue(l25)['window']['addEventListener']('load',(function JSCL_USER_NIL(){var v95=l2.value;
var I;
for (I=arguments.length-1;I>=0;I--)v95=new internals.Cons(arguments[I],v95);
var v96=this;
return internals.mvcall(l30.fvalue);
}));
})();
});
FUNC.fname=internals.make_lisp_string('WEB-INIT');
return FUNC;
})();
l81;
l81.fvalue();
})(jscl.internals);
})( typeof require !== 'undefined'? require('./jscl'):
typeof window !== 'undefined'? window.jscl: self.jscl )