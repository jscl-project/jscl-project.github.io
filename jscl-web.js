if (typeof importScripts !== 'undefined') importScripts('./jscl.js');
(function(jscl){
'use strict';
(function(values, internals){var l1=internals.make_lisp_string('loading repl-web/repl.lisp!');
console.log(internals.xstring(l1));
var l2=internals.intern('%WRITE-STRING','JSCL');
var l3=internals.intern('T');
var l4=internals.make_lisp_string('jqconsole-output');
var l5=internals.intern('*ROOT*','JSCL');
var l6=internals.intern('NIL');
var l7=internals.make_lisp_string('');
l2.fvalue=(function(){var FUNC=(function JSCL_USER_WRITESTRING(values,v1,v2,v3){internals.checkArgsAtLeast(arguments.length-1,1);
internals.checkArgsAtMost(arguments.length-1,3);
switch(arguments.length-1){case 1:v2=l3.value;
;
case 2:v3=l4;
;
default:break;
}var v4=this;
return (function(){return internals.js_to_lisp((function(){var TMP=internals.symbolValue(l5)['jqconsole'];
return TMP===undefined?l6.value:TMP;
})())!==l6.value?v2!==l6.value?internals.js_to_lisp(internals.symbolValue(l5)['jqconsole']['Write'](internals.lisp_to_js(v1),internals.lisp_to_js(v3))):internals.js_to_lisp(internals.symbolValue(l5)['jqconsole']['Write'](internals.lisp_to_js(v1),internals.lisp_to_js(v3),internals.lisp_to_js(l7))):internals.js_to_lisp(internals.symbolValue(l5)['console']['log'](internals.lisp_to_js(v1)));
})();
});
FUNC.fname='%WRITE-STRING';
return FUNC;
})();
l2;
var l8=internals.intern('LOAD-HISTORY','JSCL');
var l9=internals.make_lisp_string('jqhist');
var l10=internals.intern('JS-NULL-P','JSCL');
l8.fvalue=(function(){var FUNC=(function JSCL_USER_LOADHISTORY(values){internals.checkArgsAtMost(arguments.length-1,0);
var v6=this;
return (function(){return (function(v8){return l10.fvalue(internals.pv,v8)!==l6.value?l6.value:internals.js_to_lisp(internals.symbolValue(l5)['jqconsole']['SetHistory'](internals.lisp_to_js(internals.js_to_lisp(internals.symbolValue(l5)['JSON']['parse'](internals.lisp_to_js(v8))))));
})(internals.js_to_lisp(internals.symbolValue(l5)['localStorage']['getItem'](internals.lisp_to_js(l9))));
})();
});
FUNC.fname='LOAD-HISTORY';
return FUNC;
})();
l8;
var l11=internals.intern('SAVE-HISTORY','JSCL');
var l12=internals.make_lisp_string('jqhist');
l11.fvalue=(function(){var FUNC=(function JSCL_USER_SAVEHISTORY(values){internals.checkArgsAtMost(arguments.length-1,0);
var v9=this;
return (function(){return internals.js_to_lisp(internals.symbolValue(l5)['localStorage']['setItem'](internals.lisp_to_js(l12),internals.lisp_to_js(internals.js_to_lisp(internals.symbolValue(l5)['JSON']['stringify'](internals.lisp_to_js(internals.js_to_lisp(internals.symbolValue(l5)['jqconsole']['GetHistory']())))))));
})();
});
FUNC.fname='SAVE-HISTORY';
return FUNC;
})();
l11;
var l13=internals.intern('+ERR-CSS+','JSCL');
var l14=internals.make_lisp_string('jqconsole-error');
l13.value=l14;
l13;
var l15=internals.intern('TOPLEVEL','JSCL');
var l16=internals.make_lisp_string('(');
var l17=internals.make_lisp_string(')');
var l18=internals.make_lisp_string('parents');
var l19=internals.intern('FORMAT-ERROR','JSCL');
var l20=internals.intern('COMPLAINT','KEYWORD');
l20.value=l20;
var l21=internals.make_lisp_string('Required argument missing');
var l22=internals.intern('CONTROL-STRING','KEYWORD');
l22.value=l22;
var l23=internals.make_lisp_string('~a> ');
var l24=internals.intern('OFFSET','KEYWORD');
l24.value=l24;
var l25=internals.intern('ERROR');
var l26=internals.intern('PRINC');
var l27=internals.make_lisp_string('> ');
var l28=internals.intern('WRITE-STRING');
var l29=internals.intern('*PACKAGE*');
var l30=internals.intern('PACKAGE-NAME-FOR-PROMPT','JSCL');
var l31=internals.intern('CALL-FORMATTER','JSCL');
var l32=internals.make_lisp_string('jqconsole-prompt');
var l33=internals.intern('*ERROR-OUTPUT*');
var l34=internals.make_lisp_string('ERROR[!]: ~a~%~A~%');
var l35=internals.make_lisp_string('ERROR[!]: ');
var l36=internals.intern('TERPRI');
var l37=internals.intern('*HANDLER-BINDINGS*','JSCL');
var l38=internals.intern('SERIOUS-CONDITION');
var l39=internals.make_lisp_string('~A: ~A~%');
var l40=internals.make_lisp_string(': ');
var l41=internals.intern('CLASS-OF');
var l42=internals.intern('CLASS-NAME');
var l43=internals.intern('*TRACE-OUTPUT*');
var l44=internals.intern('FROM','KEYWORD');
l44.value=l44;
var l45=internals.intern('SIGNAL');
var l46=internals.intern('FORMAT-BACKTRACE','JSCL');
var l47=internals.intern('%%ERROR','JSCL');
var l48=internals.intern('LIST');
var l49=internals.intern('EVAL-INTERACTIVE-INPUT','JSCL');
var l50=internals.intern('FRESH-LINE');
var l51=internals.intern('PRIN1');
var l52=internals.intern('%SEXPR-INCOMPLETE','JSCL');
l15.fvalue=(function(){var FUNC=(function JSCL_USER_TOPLEVEL(values){internals.checkArgsAtMost(arguments.length-1,0);
var v11=this;
return (function(){internals.js_to_lisp(internals.symbolValue(l5)['jqconsole']['RegisterMatching'](internals.lisp_to_js(l16),internals.lisp_to_js(l17),internals.lisp_to_js(l18)));
(function(v18){return internals.js_to_lisp(internals.symbolValue(l5)['jqconsole']['Write'](internals.lisp_to_js(v18),internals.lisp_to_js(l32)));
})(l31.fvalue(internals.pv,l6.value,(function JSCL_USER_NIL(values,v14,v15){internals.checkArgsAtLeast(arguments.length-1,1);
switch(arguments.length-1){case 1:v15=l25.fvalue(internals.pv,l19,l20.value,l21,l22.value,l23,l24.value,1);
;
default:break;
}var v13=l6.value;
var I;
for (I=arguments.length-1-1;I>=2;I--)v13=new internals.Cons(arguments[I+1],v13);
var v16=this;
(function(){l26.fvalue(internals.pv,v15,v14);
return l28.fvalue(internals.pv,l27,v14);
})();
return v13;
}),l30.fvalue(internals.pv,internals.symbolValue(l29))));
return (function(v49){return internals.js_to_lisp(internals.symbolValue(l5)['jqconsole']['Prompt'](internals.lisp_to_js(l3.value),internals.lisp_to_js(v49),internals.lisp_to_js(internals.symbolFunction(l52))));
})((function JSCL_USER_NIL(values,v19){internals.checkArgs(arguments.length-1,1);
var v20=this;
return (function(){(function(){try{return (function(){try{var v31=[];
return (function(v32){return internals.bindSpecialBindings([l37],[v32],(function(){(function(){var v34=new internals.Cons(l38,(function JSCL_USER_NIL(values,v35){internals.checkArgs(arguments.length-1,1);
var v36=this;
l31.fvalue(internals.pv,internals.symbolValue(l33),(function JSCL_USER_NIL(values,v38,v39,v40){internals.checkArgsAtLeast(arguments.length-1,1);
switch(arguments.length-1){case 1:v39=l25.fvalue(internals.pv,l19,l20.value,l21,l22.value,l39,l24.value,1);
;
case 2:v40=l25.fvalue(internals.pv,l19,l20.value,l21,l22.value,l39,l24.value,5);
;
default:break;
}var v37=l6.value;
var I;
for (I=arguments.length-1-1;I>=3;I--)v37=new internals.Cons(arguments[I+1],v37);
var v41=this;
(function(){l26.fvalue(internals.pv,v39,v38);
l28.fvalue(internals.pv,l40,v38);
l26.fvalue(internals.pv,v40,v38);
return l36.fvalue(internals.pv,v38);
})();
return v37;
}),l42.fvalue(internals.pv,l41.fvalue(internals.pv,v35)),v35);
l46.fvalue(internals.pv,internals.symbolValue(l43),l44.value,internals.symbolFunction(l45));
return (function(){throw new internals.BlockNLX(v31,l6.value,'BAIL-OUT');
})();
}));
var v43=new internals.Cons(v34,internals.symbolValue(l37));
return l37.value=v43;
})();
return (function(){try{return (function(){return (function(v47,v48){(function(){while (v47!==l6.value){v48=v47.$$jscl_car;
l50.fvalue(internals.pv);
l51.fvalue(internals.pv,v48);
l36.fvalue(internals.pv);
l6.value;
v47=v47.$$jscl_cdr;
}return l6.value;
})();
return l6.value;
})((function(){var FUNC=internals.symbolFunction(l48);
var ARGS=[internals.pv];
return (function(){var values=internals.mv;
var VS;
VS=l49.fvalue(values,v19);
if (typeof VS==='object'&&VS&&'multiple-value' in VS) ARGS=ARGS.concat(VS);
 else ARGS.push(VS);
return FUNC.apply(null,ARGS);
})();
})(),l6.value);
})();
}catch (v44){v44=internals.js_to_lisp(v44);
return (internals.isNLX(v44)?l3.value:l6.value)!==l6.value?(function(){throw v44;
})():l47.fvalue(internals.pv,(function(v45){return v45!==l6.value?v45:v44;
})(internals.js_to_lisp((function(){var TMP=v44['message'];
return TMP===undefined?l6.value:TMP;
})())));
}})();
}));
})(internals.symbolValue(l37));
}catch (CF){if (CF instanceof internals.BlockNLX&&CF.id==v31) return CF.values;
 else throw CF;
}})();
}catch (v22){v22=internals.js_to_lisp(v22);
return (function(v24){return l31.fvalue(internals.pv,internals.symbolValue(l33),(function JSCL_USER_NIL(values,v26,v27,v28){internals.checkArgsAtLeast(arguments.length-1,1);
switch(arguments.length-1){case 1:v27=l25.fvalue(internals.pv,l19,l20.value,l21,l22.value,l34,l24.value,11);
;
case 2:v28=l25.fvalue(internals.pv,l19,l20.value,l21,l22.value,l34,l24.value,15);
;
default:break;
}var v25=l6.value;
var I;
for (I=arguments.length-1-1;I>=3;I--)v25=new internals.Cons(arguments[I+1],v25);
var v29=this;
(function(){l28.fvalue(internals.pv,l35,v26);
l26.fvalue(internals.pv,v27,v26);
l36.fvalue(internals.pv,v26);
l26.fvalue(internals.pv,v28,v26);
return l36.fvalue(internals.pv,v26);
})();
return v25;
}),v24,internals.js_to_lisp((function(){var TMP=v22['stack'];
return TMP===undefined?l6.value:TMP;
})()));
})((function(v23){return v23!==l6.value?v23:v22;
})(internals.js_to_lisp((function(){var TMP=v22['message'];
return TMP===undefined?l6.value:TMP;
})())));
}})();
l11.fvalue(internals.pv);
return l15.fvalue(values);
})();
}));
})();
});
FUNC.fname='TOPLEVEL';
return FUNC;
})();
l15;
var l53=internals.intern('WEB-INIT','JSCL');
var l54=internals.intern('*STANDARD-OUTPUT*');
var l55=internals.intern('WRITE-FN','KEYWORD');
l55.value=l55;
var l56=internals.intern('KIND','KEYWORD');
l56.value=l56;
var l57=internals.intern('WEB-REPL-OUTPUT-STREAM','JSCL');
var l58=internals.intern('MAKE-STREAM','JSCL');
var l59=internals.intern('WEB-REPL-ERROR-STREAM','JSCL');
var l60=internals.intern('HTML','KEYWORD');
l60.value=l60;
var l61=internals.intern('WELCOME-MESSAGE','JSCL');
var l62=internals.make_lisp_string('load');
l53.fvalue=(function(){var FUNC=(function JSCL_USER_WEBINIT(values){internals.checkArgsAtMost(arguments.length-1,0);
var v50=this;
return (function(){l8.fvalue(internals.pv);
l54.value=l58.fvalue(internals.pv,l55.value,(function JSCL_USER_NIL(values,v52){internals.checkArgs(arguments.length-1,1);
var v53=this;
return l2.fvalue(values,v52);
}),l56.value,l57);
l33.value=l58.fvalue(internals.pv,l55.value,(function JSCL_USER_NIL(values,v54){internals.checkArgs(arguments.length-1,1);
var v55=this;
return l2.fvalue(values,v54,l3.value,internals.symbolValue(l13));
}),l56.value,l59);
l43.value=internals.symbolValue(l54);
l61.fvalue(internals.pv,l60.value,l3.value);
return internals.js_to_lisp(internals.symbolValue(l5)['window']['addEventListener'](internals.lisp_to_js(l62),internals.lisp_to_js((function JSCL_USER_NIL(values){var v58=l6.value;
var I;
for (I=arguments.length-1-1;I>=0;I--)v58=new internals.Cons(arguments[I+1],v58);
var v59=this;
return l15.fvalue(values);
}))));
})();
});
FUNC.fname='WEB-INIT';
return FUNC;
})();
l53;
l53.fvalue(internals.pv);
})(jscl.internals.pv, jscl.internals);
})( typeof require !== 'undefined'? require('./jscl'):
typeof window !== 'undefined'? window.jscl: self.jscl )